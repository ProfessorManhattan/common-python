---
version: '3'

tasks:
  all:
    desc: Lint the project by running all the linters in parallel
    deps: [formatting, python]

  formatting:
    deps:
      - :common:nodejs-dependencies
    desc: Lint formatting using Prettier
    summary: |
      $ Report formatting errors with Prettier

      This task will run Prettier on the project and list the possible fixes without automatically
      applying the fixes. It will report mistakes like inconsistent indent lengths, trailing spaces,
      and more. This task is a wrapper for the `npm run lint:prettier` command. It will use the configuration
      specified in the `package.json` file under the `prettier` key.

      If this command is incompatible with a file then you can add the file to the `.prettierignore`
      file.

      For more information on Prettier, see: https://prettier.io/
    cmds:
      - npm run lint:prettier

  _formatting:
    cmds:
      - task: formatting
    sources:
      - '**/*.(css|html|js|json|less|md|mjml|php|scss|sh|ts|xml|yml)'

  python:
    deps:
      - :common:python-requirements
    desc: Lint Python files using Flake8
    summary: |
      $ Lint Python files using Flake8

      Flake8 is a Python library that lints Python projects (or projects that may include Python files).
      It is a combination of several Python linters like PyFlakes and pycodestyle. This task will run
      `flake8` using the configuration found in the `.flake8` file in the root of this project.

      The `.flake8` file is a common file shared across many of our repositories so if changes are made to
      it then the changes need to be made to the appropriate common file repository here:
      https://gitlab.com/megabyte-labs/common. Because of this, it might make more sense to add a comment
      to lines that you wish to be ignored by flake8. For instance, you can ignore rule E234 by adding
      a comment at the end of the line that looks like, "# noqa: E234".

      NOTE: In order to maintain our strict quality standards, disabling Flake8 rules should only be done
      when absolutely necessary.

      For more information on Flake8, see: https://github.com/PyCQA/flake8
    cmds:
      - flake8 .

  _python:
    cmds:
      - task: python
    sources:
      - '**/*.py'

  scripts:
    deps:
      - :common:nodejs-dependencies
    desc: Report possible errors in shell scripts
    summary: |
      $ Report possible errors in shell scripts using Shellcheck

      Shellcheck is a tool that reports warnings and suggestions for shell (e.g. bash) scripts. This
      task is a wrapper for the `npm run lint:shellcheck` command. The npm command scans the project
      for files ending with `.sh` or `.sh.j2` and runs Shellcheck on them. Files in the following folders
      are ignored:
        * .cache        * .husky
        * .git          * node_modules
        * .husky        * slim_test

      For more information on Shellcheck, see: https://github.com/koalaman/shellcheck
    cmds:
      - npm run lint:shellcheck

  _scripts:
    cmds:
      - task: scripts
    sources:
      - '**/*.(sh|sh.j2)'
